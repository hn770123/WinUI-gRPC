<Page
    x:Class="ChatApp.Views.ChannelEditPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- ヘッダー -->
        <Grid Grid.Row="0" Background="{ThemeResource SystemControlAcrylicElementBrush}" Padding="16">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <Button Grid.Column="0" Content="← 戻る" Command="{x:Bind ViewModel.GoBackCommand}" Margin="0,0,16,0"/>
            <TextBlock Grid.Column="1" Text="チャンネル編集" FontSize="24" FontWeight="Bold" VerticalAlignment="Center"/>
        </Grid>

        <!-- コンテンツ -->
        <ScrollViewer Grid.Row="1" Padding="32">
            <StackPanel MaxWidth="800">
                <!-- 新規チャンネル作成 -->
                <TextBlock Text="新規チャンネル作成" FontSize="20" FontWeight="SemiBold" Margin="0,0,0,16"/>

                <TextBox Header="チャンネル名"
                         Text="{x:Bind ViewModel.NewChannelName, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                         Margin="0,0,0,16"/>

                <TextBox Header="説明"
                         Text="{x:Bind ViewModel.NewChannelDescription, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                         AcceptsReturn="True"
                         TextWrapping="Wrap"
                         Height="100"
                         Margin="0,0,0,16"/>

                <CheckBox Content="プライベートチャンネル"
                          IsChecked="{x:Bind ViewModel.NewChannelIsPrivate, Mode=TwoWay}"
                          Margin="0,0,0,16"/>

                <TextBlock Text="{x:Bind ViewModel.ErrorMessage, Mode=OneWay}"
                           Foreground="Red"
                           Margin="0,0,0,16"
                           TextWrapping="Wrap"
                           Visibility="{x:Bind ViewModel.ErrorMessage, Mode=OneWay, Converter={StaticResource EmptyStringToCollapsedConverter}}"/>

                <Button Content="チャンネルを作成"
                        Command="{x:Bind ViewModel.CreateChannelCommand}"
                        Style="{StaticResource AccentButtonStyle}"
                        Margin="0,0,0,32"/>

                <!-- 既存チャンネル一覧 -->
                <TextBlock Text="既存チャンネル" FontSize="20" FontWeight="SemiBold" Margin="0,0,0,16"/>

                <ListView ItemsSource="{x:Bind ViewModel.Channels, Mode=OneWay}" SelectionMode="None">
                    <ListView.ItemTemplate>
                        <DataTemplate x:DataType="local:Channel">
                            <Grid Padding="8">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <StackPanel Grid.Column="0">
                                    <TextBlock Text="{x:Bind Name}" FontWeight="SemiBold"/>
                                    <TextBlock Text="{x:Bind Description}"
                                               FontSize="12"
                                               Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}"/>
                                </StackPanel>

                                <Button Grid.Column="1"
                                        Content="削除"
                                        Command="{Binding DataContext.DeleteChannelCommand, ElementName=Page}"
                                        CommandParameter="{x:Bind}"
                                        Foreground="Red"/>
                            </Grid>
                        </DataTemplate>
                    </ListView.ItemTemplate>
                </ListView>
            </StackPanel>
        </ScrollViewer>
    </Grid>
</Page>
